---
title: "20201208 HBC-TPR Exercise4"
author: "HBC_Training_Team Juwell_Wu"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: false
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Notes on Issues

If I follow the instructions as written and rename "Rscript.R" ro "Rscript.Rmd", I get persistent "unexpected token" error at every "```{r}" line in the script, regardless of the way that string was created (shortcut, insert->R, typing). Those errors didn't seem to affect Knitting, however.

This file was generated by starting a new .Rmd from scratch, and copying the Rscript code over.


# Set-up libraries and data

```{r Setup_Libraries_Data}
## Load libraries
library(tidyverse)
library(pheatmap)

## Load data
load("data/Rmarkdown_data.Rdata")
```


# Top 20 significant genes

```{r Top_20_genes}
## Get names of top 20 genes
top20_sigOE_genes <- res_tableOE_tb %>% 
  arrange(padj) %>% 	#Arrange rows by padj values
  pull(gene) %>% 		#Extract character vector of ordered genes
  head(n=20)	

## normalized counts for top 20 significant genes
top20_sigOE_norm <- normalized_counts %>%
  filter(gene %in% top20_sigOE_genes)

## Gathering the columns to have normalized counts to a single column
gathered_top20_sigOE <- top20_sigOE_norm %>%
  gather(colnames(top20_sigOE_norm)[2:9], key = "samplename", value = "normalized_counts")
gathered_top20_sigOE <- inner_join(mov10_meta, gathered_top20_sigOE)

## plot using ggplot2
ggplot(gathered_top20_sigOE) +
  geom_point(aes(x = gene, y = normalized_counts, color = sampletype)) +
  scale_y_log10() +
  xlab("Genes") +
  ylab("log10 Normalized Counts") +
  ggtitle("Top 20 Significant DE Genes") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme(plot.title = element_text(hjust = 0.5))
```

*MOV10_overpression* is associated with overpression of most of Top 20 genes. *MOV10_knockdown* is also associated with overpression of most of Top 20 genes, but with lesser effect.


# Create a heatmap of the differentially expressed genes

```{r Heat_DEgenes}
## Extract normalized expression for significant genes from the OE and control samples (2:4 and 7:9)
res_tableOE_tb_sig <- res_tableOE_tb %>%
  filter(padj < 0.05)

## Return the normalized counts for the significant DE genes
norm_OEsig <- normalized_counts %>% 
  filter(gene %in% res_tableOE_tb_sig$gene) 

meta <- mov10_meta %>%
column_to_rownames("samplename") %>%
data.frame()

## Run pheatmap using the metadata data frame for the annotation
pheatmap(norm_OEsig[2:9], 
         cluster_rows = T, 
         show_rownames = F,
         annotation = meta, 
         border_color = NA, 
         fontsize = 10, 
         scale = "row", 
         fontsize_row = 10, 
         height = 20)
```

**MOV10_overpression** has clear association with DE gene expression levels. **MOV10_knockdown** does not cause underexpression of DE genes (similar to plot above). ~~I don't know what I'm talking about.~~


# sessionInfo
```{r sessionInfo}
sessionInfo()
```